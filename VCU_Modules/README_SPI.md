# McMaster Formula Electric 
## *SPI and Accelerometer readme documentation*
Authors: Samuel Parent and Dorian Knight
Last updated: 5/30/2021
Description: The SPI and accelerometer library will allow you to initialize SPI drivers in full duplex mode. It includes custom functions to transmit, receive, and transmit/receive concurrently. Included is a layer to interface with the IMU (accelerometer) that will be used (MPU 9250).
 
# References
- [Documentation](https://macformulaelectric899-my.sharepoint.com/:w:/g/personal/royh_mcmaster_ca_ext__macformulaelectric899_onmicrosoft_com/Ebc_aJgJJYlDt1gcv1IPKoMBxGtsUiCBaRi11LwkNmfAmQ?e=VHhyr0)
- [Data Brief](https://www.st.com/resource/en/data_brief/nucleo-f767zi.pdf)
- [User Manual](https://www.st.com/resource/en/user_manual/dm00244518-stm32-nucleo144-boards-mb1137-stmicroelectronics.pdf)
 
## Features
Base layer
- Initialize a specific SPI driver (1-6), clock phase and polarity (modes 0-3), max data size of any individual buffer (4-16 bits), communication speed (kilo bits per second), most significant bit first (1) or least significant bit first (0)
- Transmit a message by providing the SPI driver (1-6), the transmit buffer memory address (location in memory), the number of pieces of data (int), the slave chip port (eg, GPIOE), the slave chip pin (eg, GPIO_PIN_4)
- Receive a message by providing the SPI driver (1-6), the receive buffer memory address (location in memory), the number of pieces of data (int), the slave chip port (eg, GPIOE), the slave chip pin (eg, GPIO_PIN_4)
- Transmit and receive a message simultaneously by providing the SPI driver (1-6), the transfer buffer memory address (location in memory), the receive buffer memory address (location in memory), the number of pieces of data (int), the slave chip port (eg, GPIOE), the slave chip pin (eg, GPIO_PIN_4)
- De-initialize the SPI driver by calling the Deinit function and passing the memory address of the desired SPI driver

Accelerometer layer
- Initialize the preset SPI accelerometer driver by calling the SPI_Accel_Init function
- Receive data by using the SPI_Accel_Receive function by providing the memory locations of the receive buffer and the number of pieces of data you wish to communicate  
De-initialize the preset accelerometer SPI driver by calling the SPI_Accel_Deinit function
 
## Build status
Module Version: V1.0

Limited to 16 bit communication, 32 bit would require concatenation between two 16 bit messages. At the moment this feature isn’t directly supported within the library and would have to be implemented on the user side. 
Currently, the SPI and accelerometer library does not support automatic error checking. This will be fixed in later updates
 
## File Description
* SPI Testing - Arduino Slave: SPI project to test the receive function - uses arduino as slave device and nucleo as master device
*  SPI_Module_Development: Development environment for the SPI library, no longer in use
* .gitkeep: Empty autogenerated file
* spi_lib.h: SPI and accelerometer library containing all of the custom functions that provide the features mentioned above. More indepth information can be found within the SPI documentation


 
## Installation
- Move the spi_lib.h file into your inc project file
- Type, “#include spi_lib.h” in your main.c file
- Enjoy your SPI library :)
- Further specific runtime cases can be found within the SPI documentation
